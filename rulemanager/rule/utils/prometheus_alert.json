[
    {
        "group": "base",
        "name": "cpu 利用率 99%",
        "rule": "cpu5musedrate > 99",
        "check_period": 5,
        "labels": "",
        "description": "cpu 使用率大于99%当前值为{{ $labels.value }}",
        "level": 2,
        "remarks": "cpu 使用率告警",
        "alert_period": 60,
        "user": "system"
    },
    {
        "group": "base",
        "name": "节点可用性检查",
        "rule": "up  == 0",
        "check_period": 5,
        "labels": "",
        "description": "{{ $labels.instance }}  节点指标获取失败",
        "level": 2,
        "remarks": "监控节点可用性监控",
        "alert_period": 60,
        "user": "system"
    },
    {
        "group": "base",
        "name": "内存使用率大于95%",
        "rule": "sort(avg by(hostname,instance, ip_address, job,cluster) ((1 - avg_over_time(node_memory_MemAvailable_bytes[5m]) / avg_over_time(node_memory_MemTotal_bytes[5m])) * 100 > 95))",
        "check_period": 5,
        "labels": "",
        "description": "{{ $labels.instance }}  {{ $labels.ip_address }}  内存使用率大于95%",
        "level": 1,
        "remarks": "内存使用率告警",
        "alert_period": 30,
        "user": "system"
    },
    {
        "group": "base",
        "name": "数据盘  磁盘空间小于50G",
        "rule": "sum(node_filesystem_avail_bytes{mountpoint =~  \"/export|/data\",fstype=~\"ext4|xfs|nfs4\"}) by (hostname,instance, mountpoint,ip_address) < 50000000000",
        "check_period": 5,
        "labels": "",
        "description": "{{ $labels.instance }}  {{ $labels.ip_address }} 磁盘空间小于 50G",
        "level": 2,
        "remarks": "数据盘磁盘空间监控",
        "alert_period": 60,
        "user": "system"
    },
    {
        "group": "base",
        "name": "系统盘空间小于5G",
        "rule": "sum(node_filesystem_avail_bytes{mountpoint =  \"/\",fstype=~\"ext4|xfs|nfs4\"}) by (hostname, mountpoint,instance) < 10000000000",
        "check_period": 5,
        "labels": "",
        "description": "{{ $labels.instance }} {{ $labels.ip_address }} 系统盘空间小于5G",
        "level": 2,
        "remarks": "系统盘空间监控",
        "alert_period": 60,
        "user": "system"
    },
    {
        "group": "base",
        "name": "系统 file describe 使用超过5w",
        "rule": "node_filefd_allocated > 50000",
        "check_period": 5,
        "labels": "",
        "description": "{{ $labels.ip_address }} 节点 fd 用量超过5w。当前值为{{ $labels.value }}",
        "level": 1,
        "remarks": "文件描述符监控",
        "alert_period": 30,
        "user": "system"
    },
    {
        "group": "base",
        "name": "系统  close_wait 数量大于100",
        "rule": "node_tcp_connection_states{state=\"close_wait\"} > 100",
        "check_period": 5,
        "labels": "",
        "description": "{{ $labels.ip_address }} 节点 close_wait 超过100，当前值为{{ $labels.value }}",
        "level": 1,
        "remarks": "close_wait 数量监控",
        "alert_period": 30,
        "user": "system"
    },
    {
        "group": "base",
        "name": "系统  time_wait 数量大于100",
        "rule": "node_tcp_connection_states{state=\"time_wait\"} > 100",
        "check_period": 5,
        "labels": "",
        "description": "{{ $labels.ip_address }} 节点 time_wait 超过100，当前值为{{ $labels.value }}",
        "level": 1,
        "remarks": "time_wait 数量监控",
        "alert_period": 30,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "zk watch > 3000",
        "rule": "zookeeper_inmemorydatatree_watchcount > 3000",
        "check_period": 5,
        "labels": "",
        "description": "{{ $labels.instance }}  zk watch > 3000",
        "level": 2,
        "remarks": "zk watch 监控",
        "alert_period": 10,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "hbase region 健康检查",
        "rule": "bigdata_process_up{name=~\"HRegionServer\"}  ==  0",
        "check_period": 5,
        "labels": "",
        "description": "hbase 集群 region {{ $labels.instance }} 节点进程消失",
        "level": 1,
        "remarks": "hbase region 健康检查",
        "alert_period": 20,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "journalnode 健康检查",
        "rule": "bigdata_process_up{name=\"JournalNode\"} ==0",
        "check_period": 5,
        "labels": "",
        "description": "journalnode {{ $labels.instance }} 节点进程消失",
        "level": 1,
        "remarks": "journalnode 健康检查",
        "alert_period": 30,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "hiveserver2 健康检查",
        "rule": "bigdata_process_up{name=\"HiveServer2\"}) == 0",
        "check_period": 5,
        "labels": "",
        "description": "hiveserver2 在 {{ $labels.instance }} 节点服务进程消失",
        "level": 1,
        "remarks": "hiveserver2 健康检查",
        "alert_period": 20,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "ranger 健康检查",
        "rule": "bigdata_process_status{name=\"ranger\"}  == 0",
        "check_period": 5,
        "labels": "",
        "description": "ranger 在 {{ $labels.instance }} 节点服务进程消失",
        "level": 1,
        "remarks": "ranger 健康检查",
        "alert_period": 20,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "elasticsearch 健康检查",
        "rule": "bigdata_process_up{name=\"Elasticsearch\"} == 0",
        "check_period": 5,
        "labels": "",
        "description": "elasticsearch 在 {{ $labels.instance }} 节点服务进程消失",
        "level": 1,
        "remarks": "elasticsearch健康检查",
        "alert_period": 30,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "logstash 健康检查",
        "rule": "bigdata_process_up{name=\"Logstash\"} == 0",
        "check_period": 5,
        "labels": "",
        "description": "logstash  在 {{ $labels.instance }} 节点服务进程消失",
        "level": 1,
        "remarks": "logstash 健康检查",
        "alert_period": 30,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "hbase regionserver 在线数量监控",
        "rule": "sum(prom_numRegionServers) <11",
        "check_period": 5,
        "labels": "",
        "description": "hbase regionserver  在线数量小于 8",
        "level": 1,
        "remarks": "hbase region 在线数量监控",
        "alert_period": 10,
        "user": "system"
    },
    {
        "group": "k8s",
        "name": "出现 pod 20分钟重启次数大于1",
        "rule": "changes(kube_pod_container_status_restarts_total[20m]) > 1",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.cluster}} 环境 {{ $labels.pod}} 在20分钟内重启 {{$labels.value}} 次",
        "level": 0,
        "remarks": "pod 健康检查",
        "alert_period": 10,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "kafka 离线副本监控",
        "rule": "kafka_server_replicamanager_offlinereplicacount  > 0",
        "check_period": 10,
        "labels": "",
        "description": "{{$labels.cluster}} {{$labels.region}} 集群出现副本同步失败 ",
        "level": 1,
        "remarks": "kafka 离线副本监控",
        "alert_period": 60,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "kafka 集群出现 broker 掉线",
        "rule": "kafka_controller_kafkacontroller_controllerstate > 0",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.cluster}} {{$labels.ip_address}} kafka集群 当前节点掉线",
        "level": 2,
        "remarks": "kafka broker 节点在线监控",
        "alert_period": 10,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "kafka 集群 broker 数量减少",
        "rule": "kafka_controller_broker_num < 5",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.ip_address}} {{ $labels.exported_cluster }}  kafka 集群出现节点下线",
        "level": 2,
        "remarks": "kafka 节点监控，利用zookeeper",
        "alert_period": 10,
        "user": "system"
    },
    {
        "group": "mysql",
        "name": "数据库当前线程超过50",
        "rule": "mysql_global_status_threads_running > 50",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.cluster}}  {{$labels.db_type}} {{$labels.ip_address}} 当前线程数 {{$labels.value}}",
        "level": 1,
        "remarks": "数据库线程监控",
        "alert_period": 10,
        "user": "system"
    },
    {
        "group": "mysql",
        "name": "数据库实例不可用",
        "rule": "mysql_up == 0",
        "check_period": 5,
        "labels": "",
        "description": "节点 {{$labels.ip_address }} 上 {{ $labels.cluster}} 环境 {{$labels.db_application}} 实例 {{ $labels.db_type}} 不可用",
        "level": 2,
        "remarks": "数据库实例监控",
        "alert_period": 10,
        "user": "system"
    },
    {
        "group": "mysql",
        "name": "数据库主库 readonly 检查",
        "rule": "mysql_global_variables_read_only{db_type=\"master\"} == 1",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.ip_address }} 上 {{ $labels.cluster}} 环境 {{$labels.db_application}} 的实例开启了 readonly 模式",
        "level": 2,
        "remarks": "数据库主库 read only 检查",
        "alert_period": 5,
        "user": "system"
    },
    {
        "group": "mysql",
        "name": "数据库从库 readonly 检查",
        "rule": "mysql_global_variables_read_only{db_type =~ \"slave\\|slow_slave\"}  == 0",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.ip_address }} 上 {{ $labels.cluster}} 环境 {{$labels.db_application}} 实例的从库关闭了 readoonly。",
        "level": 2,
        "remarks": "数据库从库 read only 检查",
        "alert_period": 5,
        "user": "system"
    },
    {
        "group": "mysql",
        "name": "数据库从库IO同步状态异常",
        "rule": "mysql_slave_status_slave_io_running == 0",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.ip_address }} 上 {{ $labels.cluster}} 环境 {{$labels.db_application}} 实例的从库 IO 同步状态异常。",
        "level": 2,
        "remarks": "从库 IO同步状态检查",
        "alert_period": 5,
        "user": "system"
    },
    {
        "group": "mysql",
        "name": "数据库从库 SQL 同步状态异常",
        "rule": "mysql_slave_status_slave_sql_running == 0",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.ip_address }} 上 {{ $labels.cluster}} 环境 {{$labels.db_application}} 库的从库 SQL 同步状态异常。",
        "level": 2,
        "remarks": "从库 SQL 同步状态检查",
        "alert_period": 5,
        "user": "system"
    },
    {
        "group": "mysql",
        "name": "数据库长事务运行数量超过10",
        "rule": "mysql_long_thread_num > 10",
        "check_period": 20,
        "labels": "",
        "description": " {{$labels.ip_address }} 上 {{ $labels.cluster}} 环境 {{$labels.db_application}} 库的 {{$labels.db_type}} 库出现运行超过10min的事务。",
        "level": 1,
        "remarks": "监测数据库事务运行超过30min数量",
        "alert_period": 70,
        "user": "system"
    },
    {
        "group": "mysql",
        "name": "数据库延迟从库同步延迟超过5小时",
        "rule": "sum (mysql_slave_status_seconds_behind_master - mysql_slave_status_sql_delay) by (cluster,db_application,db_type,instance,ip_address,master_host) > 18000",
        "check_period": 20,
        "labels": "",
        "description": "{{$labels.ip_address }} 上 {{ $labels.cluster}} 环境 {{$labels.db_application}} 库的 {{$labels.db_type}} 库延迟同步超时。",
        "level": 1,
        "remarks": "数据库延迟从库延迟时间监控",
        "alert_period": 60,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "azkaban 任务kill 数量超过 10",
        "rule": "azkaban_executor_status{status=\"KILLED\"} > 10",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.env}} 环境 {{$labels.azkaban_cluster}}  azkaban 任务kill 数量超过25",
        "level": 1,
        "remarks": "azkaban kill 任务数量监测",
        "alert_period": 10,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "azkaban 任务队列堆积超过50",
        "rule": "azkaban_executor_status{status=\"PREPARING\"}  > 50",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.env}} 环境 {{$labels.azkaban_cluster}} azkaban 任务队列堆积超过50",
        "level": 1,
        "remarks": "azkaban 任务队列监控",
        "alert_period": 10,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "azkaban 任务队列failed大于20",
        "rule": "azkaban_executor_status{status=\"FAILED\"}  > 20",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.env}} 环境 {{$labels.azkaban_cluster}}  azkaban 任务队列failed大于20",
        "level": 1,
        "remarks": "azkaban 任务队列failed监控",
        "alert_period": 10,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "azkaban 服务状态异常",
        "rule": "azkaban_executor_status{status=\"KILLED\"} >  200",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.env}} 环境 {{$labels.azkaban_cluster}}  azkaban 服务状态异常，当前kill任务超过200",
        "level": 1,
        "remarks": "azkaban web 服务状态监控",
        "alert_period": 10,
        "user": "system"
    },
    {
        "group": "bigdata",
        "name": "azkaban 任务堆积任务超过30",
        "rule": "azkaban_executor_status{status=\"PREPARING\"} > 30",
        "check_period": 5,
        "labels": "",
        "description": "{{$labels.env}} 环境 {{$labels.azkaban_cluster}}  azkaban 任务kill 数量超过25",
        "level": 1,
        "remarks": "azkaban kill 任务数量监测",
        "alert_period": 10,
        "user": "system"
    }
]